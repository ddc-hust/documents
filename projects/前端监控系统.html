<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>项目开发日志 | 叮咚澈的快乐学习时光</title>
    <meta name="description" content=" ">
    <link rel="stylesheet" href="/documents/assets/style.948f2fd7.css">
    <link rel="modulepreload" href="/documents/assets/app.c840745f.js">
    <link rel="modulepreload" href="/documents/assets/projects_前端监控系统.md.1b2a7349.lean.js">
    
    <link rel="icon" type="image/png" href="pure-logo.svg">
  <script>(()=>{const e=localStorage.getItem("vitepress-theme-appearance"),a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-6b5fd0a9><!--[--><!--]--><!--[--><span tabindex="-1" data-v-45f6ae50></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-45f6ae50> Skip to content </a><!--]--><!----><header class="VPNav no-sidebar" data-v-6b5fd0a9 data-v-0e356168><div class="VPNavBar" data-v-0e356168 data-v-8856f192><div class="container" data-v-8856f192><div class="VPNavBarTitle" data-v-8856f192 data-v-6a6f7ff6><a class="title" href="/documents/" data-v-6a6f7ff6><!--[--><img class="VPImage logo" src="/documents/pure-logo.svg" data-v-73ae1788><!--]--><!--[-->叮咚澈的快乐学习时光<!--]--></a></div><div class="content" data-v-8856f192><!----><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-8856f192 data-v-a30758ee><span id="main-nav-aria-label" class="visually-hidden" data-v-a30758ee>Main Navigation</span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/documents/" data-v-a30758ee data-v-8fba5fa8 data-v-5704c677><!--[-->首页<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/documents/frontend/javascript.html" data-v-a30758ee data-v-8fba5fa8 data-v-5704c677><!--[-->基础<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/documents/vue/vue.html" data-v-a30758ee data-v-8fba5fa8 data-v-5704c677><!--[-->Vue<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/documents/react/README.html" data-v-a30758ee data-v-8fba5fa8 data-v-5704c677><!--[-->React<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/documents/algorithm/leetcode.html" data-v-a30758ee data-v-8fba5fa8 data-v-5704c677><!--[-->算法<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/documents/%E6%89%8B%E5%86%99%E9%A2%98.html" data-v-a30758ee data-v-8fba5fa8 data-v-5704c677><!--[-->手写题<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/documents/%E5%A4%A7%E6%9D%82%E7%83%A9-%E5%89%8D%E7%AB%AF%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0.html" data-v-a30758ee data-v-8fba5fa8 data-v-5704c677><!--[-->大杂烩<!--]--><!----></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/documents/blog/actions.html" data-v-a30758ee data-v-8fba5fa8 data-v-5704c677><!--[-->文章<!--]--><!----></a><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-a30758ee data-v-8dccea88><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-8dccea88><span class="text" data-v-8dccea88><!----> 关于我 <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="text-icon" data-v-8dccea88><path d="M12,16c-0.3,0-0.5-0.1-0.7-0.3l-6-6c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l5.3,5.3l5.3-5.3c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-6,6C12.5,15.9,12.3,16,12,16z"></path></svg></span></button><div class="menu" data-v-8dccea88><div class="VPMenu" data-v-8dccea88 data-v-e73581a2><div class="items" data-v-e73581a2><!--[--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-8856f192 data-v-311055f2><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" aria-label="toggle dark mode" data-v-311055f2 data-v-781f9d1b data-v-1dda4c9c><span class="check" data-v-1dda4c9c><span class="icon" data-v-1dda4c9c><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-781f9d1b><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-781f9d1b><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-8856f192 data-v-0ae890f7 data-v-4dcbaf3a><!--[--><a class="VPSocialLink" href="https://github.com/ddc-hust/documents" title="github" target="_blank" rel="noopener noreferrer" data-v-4dcbaf3a data-v-48c45ef6><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-48c45ef6><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg><span class="visually-hidden" data-v-48c45ef6>github</span></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-8856f192 data-v-0562f5c0 data-v-8dccea88><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-8dccea88><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-8dccea88><circle cx="12" cy="12" r="2"></circle><circle cx="19" cy="12" r="2"></circle><circle cx="5" cy="12" r="2"></circle></svg></button><div class="menu" data-v-8dccea88><div class="VPMenu" data-v-8dccea88 data-v-e73581a2><!----><!--[--><!--[--><!----><div class="group" data-v-0562f5c0><div class="item appearance" data-v-0562f5c0><p class="label" data-v-0562f5c0>Appearance</p><div class="appearance-action" data-v-0562f5c0><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" aria-label="toggle dark mode" data-v-0562f5c0 data-v-781f9d1b data-v-1dda4c9c><span class="check" data-v-1dda4c9c><span class="icon" data-v-1dda4c9c><!--[--><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="sun" data-v-781f9d1b><path d="M12,18c-3.3,0-6-2.7-6-6s2.7-6,6-6s6,2.7,6,6S15.3,18,12,18zM12,8c-2.2,0-4,1.8-4,4c0,2.2,1.8,4,4,4c2.2,0,4-1.8,4-4C16,9.8,14.2,8,12,8z"></path><path d="M12,4c-0.6,0-1-0.4-1-1V1c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,3.6,12.6,4,12,4z"></path><path d="M12,24c-0.6,0-1-0.4-1-1v-2c0-0.6,0.4-1,1-1s1,0.4,1,1v2C13,23.6,12.6,24,12,24z"></path><path d="M5.6,6.6c-0.3,0-0.5-0.1-0.7-0.3L3.5,4.9c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C6.2,6.5,5.9,6.6,5.6,6.6z"></path><path d="M19.8,20.8c-0.3,0-0.5-0.1-0.7-0.3l-1.4-1.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0l1.4,1.4c0.4,0.4,0.4,1,0,1.4C20.3,20.7,20,20.8,19.8,20.8z"></path><path d="M3,13H1c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S3.6,13,3,13z"></path><path d="M23,13h-2c-0.6,0-1-0.4-1-1s0.4-1,1-1h2c0.6,0,1,0.4,1,1S23.6,13,23,13z"></path><path d="M4.2,20.8c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C4.7,20.7,4.5,20.8,4.2,20.8z"></path><path d="M18.4,6.6c-0.3,0-0.5-0.1-0.7-0.3c-0.4-0.4-0.4-1,0-1.4l1.4-1.4c0.4-0.4,1-0.4,1.4,0s0.4,1,0,1.4l-1.4,1.4C18.9,6.5,18.6,6.6,18.4,6.6z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="moon" data-v-781f9d1b><path d="M12.1,22c-0.3,0-0.6,0-0.9,0c-5.5-0.5-9.5-5.4-9-10.9c0.4-4.8,4.2-8.6,9-9c0.4,0,0.8,0.2,1,0.5c0.2,0.3,0.2,0.8-0.1,1.1c-2,2.7-1.4,6.4,1.3,8.4c2.1,1.6,5,1.6,7.1,0c0.3-0.2,0.7-0.3,1.1-0.1c0.3,0.2,0.5,0.6,0.5,1c-0.2,2.7-1.5,5.1-3.6,6.8C16.6,21.2,14.4,22,12.1,22zM9.3,4.4c-2.9,1-5,3.6-5.2,6.8c-0.4,4.4,2.8,8.3,7.2,8.7c2.1,0.2,4.2-0.4,5.8-1.8c1.1-0.9,1.9-2.1,2.4-3.4c-2.5,0.9-5.3,0.5-7.5-1.1C9.2,11.4,8.1,7.7,9.3,4.4z"></path></svg><!--]--></span></span></button></div></div></div><div class="group" data-v-0562f5c0><div class="item social-links" data-v-0562f5c0><div class="VPSocialLinks social-links-list" data-v-0562f5c0 data-v-4dcbaf3a><!--[--><a class="VPSocialLink" href="https://github.com/ddc-hust/documents" title="github" target="_blank" rel="noopener noreferrer" data-v-4dcbaf3a data-v-48c45ef6><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" viewbox="0 0 24 24" class="icon" data-v-48c45ef6><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"></path></svg><span class="visually-hidden" data-v-48c45ef6>github</span></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-8856f192 data-v-6f008456><span class="container" data-v-6f008456><span class="top" data-v-6f008456></span><span class="middle" data-v-6f008456></span><span class="bottom" data-v-6f008456></span></span></button></div></div></div><!----></header><!----><!----><div class="VPContent" id="VPContent" data-v-6b5fd0a9 data-v-a4c57a06><div class="VPDoc" data-v-a4c57a06 data-v-79ca2460><div class="container" data-v-79ca2460><div class="aside" data-v-79ca2460><div class="aside-curtain" data-v-79ca2460></div><div class="aside-container" data-v-79ca2460><div class="aside-content" data-v-79ca2460><div class="VPDocAside" data-v-79ca2460 data-v-779d834d><!--[--><!--]--><!--[--><!--]--><div class="VPDocAsideOutline has-outline" data-v-779d834d data-v-51e5a8ce><div class="content" data-v-51e5a8ce><div class="outline-marker" data-v-51e5a8ce></div><div class="outline-title" data-v-51e5a8ce>On this page</div><nav aria-labelledby="doc-outline-aria-label" data-v-51e5a8ce><span class="visually-hidden" id="doc-outline-aria-label" data-v-51e5a8ce> Table of Contents for current page </span><ul class="root" data-v-51e5a8ce><!--[--><li style="" data-v-51e5a8ce><a class="outline-link" href="#项目开发日志" data-v-51e5a8ce>项目开发日志</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#性能数据sdk" data-v-51e5a8ce>性能数据sdk</a><!----></li><li style="" data-v-51e5a8ce><a class="outline-link" href="#白屏异常监测" data-v-51e5a8ce>白屏异常监测</a><!----></li><!--]--></ul></nav></div></div><!--[--><!--]--><div class="spacer" data-v-779d834d></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-79ca2460><div class="content-container" data-v-79ca2460><!--[--><!--]--><main class="main" data-v-79ca2460><div style="position:relative;" class="vp-doc _documents_projects_%E5%89%8D%E7%AB%AF%E7%9B%91%E6%8E%A7%E7%B3%BB%E7%BB%9F" data-v-79ca2460><div><h2 id="项目开发日志" tabindex="-1">项目开发日志 <a class="header-anchor" href="#项目开发日志" aria-hidden="true">#</a></h2><h3 id="运行demo项目" tabindex="-1">运行demo项目 <a class="header-anchor" href="#运行demo项目" aria-hidden="true">#</a></h3><ul><li><p>今天要吧前端监控项目跑起来，监控的方法昨天已经大致看过了，虽然有很多细节不太明白，但是其实搞懂每一个细节，现在对我来说没有太大的意义，我觉得需要把项目跑起来，然后看一看关于如何使用sdk这个。</p></li><li><p>项目介绍说使用了pnpm+changesets来搭建monorepo架构的前端监控系统，pnpm是一个更快的包管理器，在npm上做了相应的改进，changesets是针对多包的，它可以准备的知道某个改动来自于哪一个包。**这里不是很理解多包。**是的，这个项目中反复提到了多包，包括monorepos也提到了多包，这个就是将多个包放在同一个仓库下进行管理。这个项目涉及到了多个包，比如分为核心模块、性能监测模块、页面录频模块，这些分为不同的包，放在同一个仓库下，可以支持用户选择自己想要的包进行安装。——这种多包的形式我之前没有接触到过，可以了解一下。</p></li><li><p>运行了demo项目，demo项目时可以正常运行的，demo项目中直接使用了web-see发布的包，然后用户点击的时候，可能是在项目中抛出错误，然后可以验证web-see的包，也就是接入的sdk是可以正常监测到错误的。先看一下如何在项目中抛出错误，然后接入sdk的方法。</p></li><li><p>demo项目中用户抛出了错误，但是项目代码调用了getData函数，向http://localhost:8083/getErrorList请求了数据，然后就拿到了报错的数据。来分析一下是如何拿到报错的信息的</p></li><li><ul><li>首先用户触发了报错</li><li>向这个getErrorList请求数据，那么这个接口的数据是从哪里来的，好像是使用了expree框架</li><li>在main.js文件中，按照web-see的配置，配置了vue项目的上报地址，也就是http://localhost:8083/reportData，所以web-see这个sdk监测到错误后，会将错误的信息上报给这个接口</li><li>express搭建了静态服务器，拿到这个接口传来的数据后，会将数据存入数据库（这个demo项目中其实就是几个数组而已，比如errorList数组，performanceList数组等），</li><li>然后由于express搭建了静态服务器，所以前端展示报错信息的table中，将会向express服务器请求错误数据，然后把错误信息展示出来。</li><li>所以这个demo项目很好的展示了，web-see这个sdk是可以自动监测到用户触发的错误，然后把错误信息存入数据库中，然后从数据库中取错误信息，并且完整的展示出来了。</li><li>很好，这个demo项目很好。后续自己也要做一个demo项目，可以是基于vue的，然后也使用express搭建静态服务器，然后插入自己的sdk，并让sdk将监测到的错误信息发送到自己搭建的静态服务器中，把错误信息存入数据后，在demo项目中展示出来。</li></ul></li><li><p>现在需要去看一下，这个sdk项目是怎么做好的。sdk的插入是直接使用npm下载依赖，然后有一点基础的配置。而且针对不同的项目还有不同的配置方法。</p></li></ul><h3 id="性能数据的监测" tabindex="-1">性能数据的监测 <a class="header-anchor" href="#性能数据的监测" aria-hidden="true">#</a></h3><ul><li><p>走神了，赶紧看一下性能数据的监测要怎么弄，弄成SDK要发布的</p></li><li><p>创建项目，在项目下创建两个文件夹，pkg1和pkg2表示两个包（这样和sdk之后设计成核心模块和性能模块有关联，插件形式），使用pnpm init可以初始化项目。</p></li><li><p>但是项目中提到在npm上创建组织名，不知道这个是为什么？有什么用？</p></li><li><p>在pkg2中通过<code>import { pkg1 } from &#39;@chuche-monitor/pkg1&#39;;</code>调用pkg1，最开始的时候是报错的，后来在pkg2中依赖了pkg1就没有报错了，执行了命令<code>pnpm install @chuche-monitor/pkg1 --filter @chuche-monitor/pkg2</code>后，pkg2的package.json中多出了<code>dependencies</code>依赖</p><div class="language-json"><span class="copy"></span><pre><code><span class="line"><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">dependencies</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">@chuche-monitor/pkg1</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">workspace:^</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div></li><li><p>使用rollup工具进行打包。</p></li><li><p>npm 包一般的版本结构为：<code>1.0.0</code>，类似这样的三位数版本号，分别是对应的 changeset version 里面的：<code>major</code>、<code>minor</code>、<code>patch</code></p></li><li><p>使用changesets进行版本控制和管理。</p></li><li><p>workspace协议：pnpm使用了workspace协议，packages下包含各种包，各种包之间可以相互引用。</p></li><li><p>在npm官网上可以创建组织，按照教程中的执行pnpm run changeset, pnpm publish等命令，就可以发包了</p></li><li><p>性能数据的监测很显然是一个插件，需要去看一下这个插件是怎么实现的。</p><ul><li><p>先创建一个performance文件夹，然后<strong>执行pnpm init，进行初始化</strong></p></li><li><p>创建src文件夹，创建index.ts作为入口文件，修改package.json中的name为组织名+包名</p><div class="language-json"><span class="copy"></span><pre><code><span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">name</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">@chuche-monitor/performance</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// 组织名+包名</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">version</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">1.0.0</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">description</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">main</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">src/index.ts</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// 入口文件</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">publishConfig</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">main</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">dist/index.js</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">access</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">public</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">scripts</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">test</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">echo </span><span style="color:#A6ACCD;">\&quot;</span><span style="color:#C3E88D;">Error: no test specified</span><span style="color:#A6ACCD;">\&quot;</span><span style="color:#C3E88D;"> &amp;&amp; exit 1</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">keywords</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[],</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">author</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">license</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">ISC</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div></li></ul></li><li><p>性能数据的监控中，fp, fcp等指标数据的获取，是通过chrome团队提供的web-vitals库获取的。</p><ul><li>但是web-vitals不支持safari浏览器，对于safari浏览器，还是使用performance observer api来实现的。</li></ul></li><li><p>在工程下，创建type文件夹，这个子项目专门用于存储类型的。</p></li><li><p>有用到typescript定义函数接口类型</p><div class="language-js"><span class="copy"></span><pre><code><span class="line"><span style="color:#89DDFF;font-style:italic;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">interface</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Callback</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// 这里定义了一个函数类型，参数是任意数量任意类型的，返回值也是任意类型</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">(...</span><span style="color:#A6ACCD;">args</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">any</span><span style="color:#A6ACCD;">[]</span><span style="color:#89DDFF;">):</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">any</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div></li><li><p><strong>子工程之间存在依赖</strong>，比如performance中需要用到type中的类型定义.可以使用</p><div class="language-js"><span class="copy"></span><pre><code><span class="line"><span style="color:#A6ACCD;">pnpm install </span><span style="color:#89DDFF;">@</span><span style="color:#A6ACCD;">chuche</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">monitor</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">types </span><span style="color:#89DDFF;">--</span><span style="color:#A6ACCD;">filter </span><span style="color:#89DDFF;">@</span><span style="color:#A6ACCD;">chuche</span><span style="color:#89DDFF;">-</span><span style="color:#A6ACCD;">monitor</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">performance</span></span>
<span class="line"></span></code></pre></div><ul><li><p>filter的意识是针对特定的包进行操作，也就是说在performance项目中安装types依赖，这样在performace的package.json文件中就存在对types子项目的依赖</p></li><li><div class="language-js"><span class="copy"></span><pre><code><span class="line"><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">dependencies</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">@chuche-monitor/types</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">workspace:^</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div></li></ul></li><li><p><strong>入口文件</strong>：每个子项目都存在入口文件index.ts， 这个index.ts中将core文件夹下的东西导出供其它地方使用</p></li><li><p><strong>插件的设计</strong>：performance子项目作为一个插件，是要供外部使用的，所以performance子项目的入口文件index.ts中，需要实现一个类，并且这个类继承了baseplugin类，这样才可以作为插件使用</p><ul><li>BasePlugin是一个类，有一个type属性，标识插件的类型——<strong>需要去搞懂一下插件的类型有哪几种</strong>，type属性标识的就是插件的类型，就是分为性能插件，用户行为插件，白屏插件等</li><li>插件类有一个核心方法core，传入的参数是sdkBase</li><li><strong>packages</strong>文件夹下都是各自独立的包，相当于各自独立的项目，每个项目都是设计好的插件，每个插件的src文件夹下，都是一个index.ts文件+core文件夹</li><li>**不同插件包之间创建依赖：**上上面的笔记，<strong>需要注意的是需要去根目录下运行命令</strong></li><li><strong>common插件</strong>：在common插件下，创建一个constant.ts文件，用于导出常量，<strong>比如事件的类型，这里有些奇怪，事件的类型种类分的很细，有白屏、性能、行为、xhr、fetch、dom、vue、react等等</strong></li><li>插件的core方法中，就是上报数据的地方，在core方法中，调用preformance中写好的获取性能数据的函数，传入一个回调函数，这个回调函数，在performance中会有写好的callback，并在performance的函数中，将获取到的性能数据作为参数传给这个回调函数callback，然后在性能插件的core方法中，就可以在参数中res获取到性能数据，那么在插件的core方法中要做的就是将数据上报出去，这里用到了transportData，不知道这个是干什么用的？不知道是怎么使用的</li><li><strong>transportData</strong>方法中有用到获取时间戳函数getTimestamp，这个是在另外一个插件utils中使用的，在utils的helpers.ts中有这个函数的定义，通过使用Data.now就可以获取当前时间戳。</li><li>到此，好像性能插件部分已经弄完了。到底是怎么使用的呢？</li></ul></li></ul><h3 id="插件" tabindex="-1">插件 <a class="header-anchor" href="#插件" aria-hidden="true">#</a></h3><ul><li>有一个核心插件core, 然后性能插件、白屏插件、错误插件这种是独立开来的，先使用核心插件，如果要使用其它插件的话，就注册其它插件，通过chuche-monitor.use方法插入其它插件</li><li>这里好像不同框架使用插件的方式不一样，我这里其实是定义好了其它插件，然后希望可以将插件注入到项目中，就好像在vue框架中使用element-ui插件一样，他们都是一样的用法。<strong>对于不同的框架，在框架中引入插件，我需要先在框架中引入核心插件，然后根据实际需要再引入其它功能的插件</strong></li><li>性能插件已经写好了，先去弄懂核心插件里面有什么？</li><li>核心core插件需要可以注册其它插件，所以核心插件中需要实现install函数</li><li>**intall和use有啥区别？？**在react项目中使用了init函数，在vue项目中使用的是vue.use函数（不知道这个vue.use是否和这个install有关系？应该是没有关系的，install函数是用于注册其它插件使用的）</li><li><strong>在install函数中有一个vue的flag的判断，不知道这个是干什么用的？</strong></li><li><strong>事件类型eventtype中不知道为什么会有vue和react，这怎么会是事件类型呢？</strong></li><li><strong>这个replaceType不知道是什么？，好像是事件类型</strong></li><li>在utils模块中的global和support不知道是干嘛的</li><li><strong>作者自己定义了Window类型</strong>，自己定义了websee，<strong>设计到插件的发布订阅模式</strong>，前面说的replaceFlag好像就是订阅事件用的，代码中就是订阅了vue事件</li><li><strong>作者重写了vue项目的报错方式，在vue.config.errorHandle中报错</strong></li><li><strong>项目中使用到了图片打点上报，不太清楚这个的作用</strong></li><li>上报数据reportData中继承了各种监控指标的类型的data,，然后又额外添加了一些共性要上报的指标。（在types模块下定义了不同指标上报的不同类型的数据）</li><li><strong>数据上报的方式：优先使用sendBeacon 上报，若数据量大，再使用图片打点上报和fetch上报</strong></li><li><strong>发布订阅模式在core模块中有定义</strong></li><li>现在的问题是需要将其它一些监控做成可插即用的方式，我可以先做性能检测和白屏检测，将这两个作为插件放进去。所以需要思考的问题是，怎么做到即插即用，core发包之后，如何做成可扩展的插件。好像是用到发布订阅模式，——<strong>需要去看一下发布订阅模式是怎么弄的？</strong></li></ul><h3 id="发包" tabindex="-1">发包 <a class="header-anchor" href="#发包" aria-hidden="true">#</a></h3><ul><li>pnpm run changeset major\minor\xxx</li><li>pnpm run packages-version</li><li>pnpm run publish</li></ul><h3 id="测试" tabindex="-1">测试 <a class="header-anchor" href="#测试" aria-hidden="true">#</a></h3><p>项目已经发包了，需要去测试一下是否可以正常使用，**在一个项目中，我是怎么注入到原项目中进行埋点的呢？这个需要去看一下，怎么弄的，**一个正常运行的项目，我想知道这个项目的性能，我需要对这个项目进行埋点，加载插件之后，这个数据是怎么检测到的，数据又是怎么上传的，应该不可以让用户自己去处理埋点，<strong>埋点是自动的，这个应该怎么实现？</strong></p><ul><li>先去创建一个项目，加载这个core插件，看看是否加载成功</li><li>去看一下web-see-demo项目中是如何使用插件的？web-see-demo项目中，引入web-see是引入的core包，并且只引入了core，性能，以及录频。<strong>用户行为，接口监控这些是怎么使用的？为什么没有引入？</strong>——我惊讶的发现只有性能和；录频是分出来的，也就是说，在这个插件中，用户行为以及一些其它的东西，都是集成到core中的，怪不得我直接写core的时候老是会遇到用户行为的代码。<strong>那么白屏呢?白屏也是没有分出来的吗？</strong>，使用vue.use就加载了这个core插件，然后呢？然后数据是怎么埋点的呢？</li><li>监控项目中也没有使用性能数据哎。<strong>web-see当中到底是如何自动监控到错误，然后上报的？</strong>，这个埋点的时机到底是怎么做的？监控项目中没有写多余的代码，感觉需要在web-see-core中去检查，应该是在包中埋得点。在包中，vue项目中会抛出错误，然后就会检测到，重写了vue得报错函数，然后就可以实现埋点了。<strong>埋点应该就是这样，在加载插件的时候，执行vue.use的时候，会去执行包的install函数，应该在这里会有埋点函数的执行</strong></li><li>**插件的埋点：**在vue项目被埋点的项目中，使用vue.use加载包，vue.use这个函数会自动执行包的install函数，于是在我们设计的主包core的install函数中，会去重写vue项目的报错，也就是在这里就会进行埋点，<strong>需要去思考一下，这里的埋点什么时候执行，main.js什么时候执行，对于加载过程中的错误，是否会被检测到，这个是需要考虑的问题</strong>。</li><li><strong>为什么install函数中只有对vue报错的拦截，其它的东西不考虑吗？</strong>；——好像考虑了，在init函数中有</li><li><strong>自己设计插件的埋点</strong>：在core包中如果想要加载其它可插可拔式的插件，可以通过在包core中的use函数中，去执行插件的core函数。是的，我的每个插件的核心都是一个core函数，如果想要加载这个插件，就需要去执行这个core函数，相当于core包的install函数。就是埋点的位置所在。</li><li>终于一整套流程弄通了。</li><li><strong>明明安装的是chuche-monitor/core，为什么最后type, common, utils都安装了呢？或许是因为core中添加了对这个几个的依赖？？？</strong></li><li>在测试被监控项目vue2中出现包引用错误的问题，是因为自己的包有问题，好像需要有dist文件夹才可以，后面要看看build的操作。</li><li>流程打通了，引用包的问题，是因为需要构建包才可以，在根目录下，使用pnpm run build就可以，会在packages目录下的每个子项目中生成dist文件夹</li></ul><h3 id="打包" tabindex="-1">打包 <a class="header-anchor" href="#打包" aria-hidden="true">#</a></h3><ul><li>打包是通过rollup，rollup.config.js 会读取 packages 文件中各子目录的名称，并将每一个目录设置成打包的入口文件，并配置对应的出口路径</li></ul><h2 id="性能数据sdk" tabindex="-1">性能数据sdk <a class="header-anchor" href="#性能数据sdk" aria-hidden="true">#</a></h2><ul><li>经过前面的操作，目前已经实现了自定义的插件，并且可以在项目中埋点使用了，而且可以扩展插件。就是需要去看一下这个插件是不是受限于框架的。——应该是不受限于框架的，执行init函数就可以。</li><li>目前基本的展示来不及做，先把sdk做出来再说。</li><li>性能数据的sdk做好了，可以获取到相应的数据，并且发包之后，就可以正常埋点了（<strong>但是对于页面，不同页面会有不同的数据吗？还是只有一次数据？我认为对于单页面应用，是只有一次数据的，所以已经可以了</strong>）</li><li>可以去做白屏异常了</li></ul><h2 id="白屏异常监测" tabindex="-1">白屏异常监测 <a class="header-anchor" href="#白屏异常监测" aria-hidden="true">#</a></h2><ul><li><p>采用采样对比+白屏修正的方案</p></li><li><p><strong>采样对比：</strong></p><ul><li>从页面上选取17个采样点，判断这17个采样点所在的dom节点是否是容器元素。如果是容器元素，我们就认为这里是空白的。如果17个采样点所在的dom节点均是容器元素，则认为是白屏</li><li>（存在问题，就是可能在加载过程中dom节点还没有显示出来，不能认为就是白屏——针对这种情况，采用白屏修正方案）</li></ul></li><li><p><strong>白屏修正</strong>：</p><ul><li>若初次判断是白屏的话，就启动轮询机制，<strong>那什么时候上报白屏呢？</strong><ul><li>如果是网络不好，关键js资源或者接口数据没有返回，那么会出现阶段性的白屏。这个时候采用轮询机制，去判断空白点数是否是17，后面正常渲染之后，就不会是17了，就不会上报白屏</li><li>但是如果是出现了Bug，应该上报白屏的时候，那么轮询机制总要有一个时间，这个时间应该以什么时候为准呢？ <ul><li>代码中设置了浏览器的空闲时间，根据浏览器的空闲时间去判断是否执行采样函数。如果没有空闲时间，那么轮询机制下，其实并没有执行采样函数。<strong>为了优化轮询带来的损耗，一直在执行采样，于是设置只有在有空闲时间的情况下采取执行轮询函数</strong>。</li><li>对于不支持空闲时间函数的浏览器，轮询函数中会默认执行采样函数，也就是说对于白屏异常的监控，是在后台一直挂着一个采样函数，<strong>那就会一直采样，一直轮询，不久没有尽头了</strong>。<strong>现在的问题是，不是没有尽头，是会一直报白屏错误。对于正常情况，是先报白屏错误，然后报白屏正常，以最后的结果为准</strong>，那么不管怎么弄，最后都要有一个时间的限制，可以设置多长时间呢？3秒吧——不是很合理 <ul><li>可采用设置是在一定的轮询次数和时间截止条件下进行白屏监测——指标不治本</li></ul></li></ul></li></ul></li></ul></li><li><p>**白屏采样的时机：**之前一直不知道到底是什么时候开始执行白屏采样的代码的？发现代码中有一个domcument.readyState的判断，不知道这个状态的更改，页面到底是处于什么时机下？——<strong>文档的状态有加载中，可交互以及加载完成</strong>。当document.readyState为complete的时候，就是html已经解析完毕，并且页面资源加载完毕，在这之后，再进行白屏异常的监控——**不过再web-see中，如果是骨架屏，就不会等到页面资源全部加载完毕了。</p><ul><li>白屏异常监测的时机应用到了<strong>document.readyState为complete，当处于这个时机的时候，说明整个文档和它的子资源已经加载完毕，子资源指的是html文档引用的其它资源，比如图片、样式表以及脚本文件等。window.onload表示的是整个页面的所有资源都已经加载完毕，包括文档、子资源以及动态加载的资源</strong>。动态加载的资源比如javascript动态加载的，或者是通过网络请求ajax动态获取的。如果处于网络不好的环境中，可能这些动态加载的资源还没加载完成，就已经到达了complete阶段，这个时候，页面可能会出现白屏。——对于这种情况，需要加载轮询机制。</li></ul></li><li><p><strong>简述白屏异常：</strong>：去采样点，在页面上画一个十字，在横着上取9个采样点，把页面分成10等份。在竖线上取9个采样点，把页面分成10等份。通过document.elementsFromPoint函数可以获取指定坐标点所在的dom节点。判断这个17个采样所在的dom节点是否为容器节点，如果17个采样点所在的节点都是容器节点，就认为是白屏，就上报数据。但是考虑到可能由于资源的动态加载，由于网络原因导致资源返回的比较慢导致阶段的白屏，对于这种情况，我们加入轮询机制，如果17个采样点都是容器节点的话，就不停的继续采样，上报现象。对轮询加以轮询次数的限制以及轮询时间的限制。——<strong>这个代码中没有加</strong></p></li><li><p>白屏异常的监测代码基本看完了，需要去看一下，这个白屏异常监测的代码是怎么嵌入到core中的。</p></li><li><p>在core下面有一个handleEvents文件，这个文件中，定义i了一个handleEvents对象，这个对象中有对白屏异常代码的加载。</p></li><li><p>对handleEvenets的调用，在setupReplace文件中有对应的代码。这个setupReplace好像是对什么东西进行了重写？？？</p></li><li><p>涉及到发布订阅模式了号线给，在core中，core中封装了一些核心的功能，这些功能好像也使用到了发布订阅模式。好像是当用户选择开启什么时间，就开启对应的事件。就是说当用户开启一个开关，就相当于发布，然后再插件中去开启对应的监测代码。</p></li><li><p>首先在setupReplace中有一个函数，叫做addReplaceHandler，这个函数中注入了白屏监测的代码。</p><ul><li><p>在replace.ts中有addReplaceHandler的具体实现，这个函数中，调用subscribeEvent函数，判断是否订阅了这个事件，如果没有直接返回，不然的话，调用replace函数，并传入事件的类型。</p></li><li><p>在replace函数中，根据传入的事件类型，调用对应功能的replace函数，这里调用的是whitescreen函数，在这个函数中，调用了notify函数 ，notify函数中传入了对应的事件类型。</p></li><li><p>notify在subscribe.ts文件中有定义，这里每个事件都有对应的回调函数，白屏事件有对应的白屏监测的代码，http监测有对应的http监测的代码。所以在代码中，设置了handler，每个事件，都有对应的回调函数。当用户开启某个事件的时候，就相当于执行某个事件对应的回调函数。<strong>但是这里发布订阅模式的体现在哪里呢？</strong>，在notify中就是根据对应事件的名称，去执行了对应事件的回调函数。</p><ul><li>追溯到白屏监测代码最开始注入的地方，我知道了，subscribe订阅事件，相当于将事件的回调函数注入到handles中。notify通知事件，相当执行对应事件的的回调函数。最开始将白屏监测的代码，通过addReplaceHanled加入，然后，在这个函数中，会去调用subscritbe函数，将这个白屏监测的回调函数和事件进行了绑定。接着执行replace函数，调用notify函数，执行相应的这个事件的回调函数。</li><li>不给自己设限，承担自己应该承担的风险，同时也要知道所走的每一步路都是后续的积淀，种花得花，种豆得豆，还是要脚踏实地。</li></ul></li><li><p>**发布订阅模式：**发布订阅模式可以解耦发布者和订阅者之间的关系。提高扩展性，可以方便的添加订阅者，无需修改发布者的代码。</p><ul><li>在监控sdk中，由于有多种指标需要监控，比如监控js错误，监控http请求链路，监控白屏异常等。这些监控的指标可以作为订阅者，在发布者中代表的就是监控事件。sdk将事件作为消息发布，维护一个订阅者列表，订阅者就是不同事件对应的处理函数。</li><li>使用时，用户可以选择是否开启某个指标的监控，如果开启了，在sdk中就相当于把这个事件作为消息发布了，然后可以去通知订阅者，从而执行这个指标对应的执行代码。</li><li>这样以后如果要增加新的指标的监控的时候，不需要改动已有的代码，就可以实现，——可扩展性。</li></ul></li></ul></li></ul></div></div></main><footer class="VPDocFooter" data-v-79ca2460 data-v-04568844><div class="edit-info" data-v-04568844><!----><div class="last-updated" data-v-04568844><p class="VPLastUpdated" data-v-04568844 data-v-0ce8c960>Last updated: <time datatime="2023-09-24T18:24:06.000Z" data-v-0ce8c960></time></p></div></div><!----></footer><!--[--><!--]--></div></div></div></div></div><!----><!--[--><!--]--></div></div>
    <script>__VP_HASH_MAP__ = JSON.parse("{\"untitled.md\":\"17a110bb\",\"algorithm_leetcode.md\":\"89398752\",\"algorithm_输入输出.md\":\"7f78e996\",\"blog_actions.md\":\"95b195f2\",\"blog_generator.md\":\"0dbab417\",\"engineering_gulp.md\":\"c05eebf8\",\"engineering_webpack.md\":\"003ac9f2\",\"engineering_工具.md\":\"269e9ce6\",\"frontend_es6.md\":\"c3e46a1b\",\"frontend_readme.md\":\"ead809b8\",\"frontend_browser.md\":\"ad3875ee\",\"frontend_css.md\":\"28c66830\",\"frontend_http.md\":\"9cc91a39\",\"frontend_javascript.md\":\"223bc0d5\",\"frontend_less.md\":\"37c2f8c3\",\"frontend_nodejs.md\":\"04969a44\",\"index.md\":\"16548dd3\",\"me_index.md\":\"6738e9b9\",\"projects_前端监控系统.md\":\"1b2a7349\",\"react_readme.md\":\"7433d4c6\",\"tools_git.md\":\"628b561f\",\"vue_vue.md\":\"e5f6fd4b\",\"前端监控系统.md\":\"0da7d773\",\"大杂烩-前端学习笔记.md\":\"be75563b\",\"手写题.md\":\"de163ffd\",\"面试.md\":\"538dce32\",\"面试题.md\":\"3745ac6b\"}")</script>
    <script type="module" async src="/documents/assets/app.c840745f.js"></script>
    
  </body>
</html>